# .github/workflows/swift-tests.yml
name: Swift Tests

on:
  workflow_dispatch: # TODO: remove this line after having succesfully tested the workflow
  pull_request:
    branches: [unit_tests_on_PR] # `main` or 'master' or your default branch
  push:
    branches: [unit_tests_on_PR]

jobs:
  test:
    name: Run Unit Tests
    runs-on: macos-15

    steps:
      - name: Select Xcode version
        run: "sudo xcode-select --switch /Applications/Xcode_16.3.app/Contents/Developer" # adjust to your target version

      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Build and test with logs
        run: |
          set -o pipefail && \
          xcodebuild test \
            -scheme Trio \
            -sdk iphonesimulator \
            -destination 'platform=iOS Simulator,name=iPhone 15,OS=17.4' \
            -enableCodeCoverage YES \
            | tee xcodebuild.log
        continue-on-error: true
      
      - name: Upload xcodebuild log
        if: ${{ always() }}
        uses: actions/upload-artifact@v4
        with:
          name: xcodebuild.log
          path: xcodebuild.log